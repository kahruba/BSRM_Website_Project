<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>View Employees - BSRM</title>
<link rel="stylesheet" href="styles.css">
<style>
body { margin:0; font-family:Arial,sans-serif; background:#f0f2f5; }
header { width:100%; background-color:#0072ff; color:white; padding:20px; text-align:center; box-shadow:0 4px 10px rgba(0,0,0,0.2);}
header h1 { margin:0; font-size:28px; }

.table-container { width:90%; max-width:900px; margin:30px auto; overflow-x:auto; }
table { width:100%; border-collapse:collapse; background:#fff; border-radius:10px; overflow:hidden; box-shadow:0 6px 14px rgba(0,0,0,0.08);}
th, td { padding:12px; border-bottom:1px solid #eee; text-align:left; }
thead { background:#0072ff; color:#fff; }

.action-btn { padding:6px 10px; border:none; border-radius:6px; cursor:pointer; color:#fff; margin-right:4px; }
.info-btn { background:#4CAF50; }
.delete-btn { background:#f44336; }

/* Modal for Employee Info */
.modal-bg { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000; }
.modal { background:#fff; padding:20px; border-radius:12px; width:420px; max-width:90%; box-shadow:0 6px 20px rgba(0,0,0,0.2); text-align:center; }
.modal h3 { margin-top:0; color:#0072ff; }
.modal form { text-align:left; }
.modal .input-group { margin-bottom:12px; }
.modal .input-group label { display:block; font-weight:bold; margin-bottom:5px; color:#333; }
.modal .input-group input { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; background:#f0f4ff; color:#333; box-sizing:border-box; }

/* Done button */
.modal button { padding:10px 20px; border:none; border-radius:6px; cursor:pointer; margin-top:10px; font-weight:bold; color:#fff; background:#0072ff; }
.modal button:hover { opacity:0.85; }

/* Delete Confirmation Box */
.confirm-box { display:none; width:400px; max-width:90%; background:#ffeb3b; color:#333; padding:20px; border-radius:10px; text-align:center; font-weight:bold; box-shadow:0 6px 20px rgba(0,0,0,0.2); margin:20px auto;}
.confirm-box button { margin:10px 5px; padding:10px 20px; border:none; border-radius:6px; cursor:pointer; font-weight:bold; color:#fff; }
.yes-btn { background:#4CAF50; }
.no-btn { background:#f44336; }

/* Success message */
.success-msg { display:none; width:400px; max-width:90%; background:#4CAF50; color:#fff; padding:15px; border-radius:10px; text-align:center; font-weight:bold; box-shadow:0 6px 20px rgba(0,0,0,0.2); margin:20px auto;}
</style>
</head>
<body>

<header>
  <h1>View Employees</h1>
</header>

<div class="table-container" id="tableContainer"></div>

<!-- Modal for Employee Info -->
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h3>Employee Profile</h3>
    <form>
      <div class="input-group">
        <label>Full Name</label>
        <input type="text" id="mName" disabled>
      </div>
      <div class="input-group">
        <label>Address</label>
        <input type="text" id="mAddress" disabled>
      </div>
      <div class="input-group">
        <label>Department</label>
        <input type="text" id="mDepartment" disabled>
      </div>
      <div class="input-group">
        <label>Skills</label>
        <input type="text" id="mSkills" disabled>
      </div>
      <div class="input-group">
        <label>Date of Birth</label>
        <input type="date" id="mDob" disabled>
      </div>
      <div class="input-group">
        <label>Status</label>
        <input type="text" id="mStatus" disabled>
      </div>
      <button type="button" onclick="closeModal()">Done</button>
    </form>
  </div>
</div>

<!-- Delete confirmation box -->
<div class="confirm-box" id="confirmBox">
  Do you really want to delete this employee?
  <div>
    <button class="yes-btn" onclick="confirmDelete()">Yes</button>
    <button class="no-btn" onclick="cancelDelete()">Cancel</button>
  </div>
</div>

<!-- Success message -->
<div class="success-msg" id="successMsg">
  Employee deleted successfully!
</div>

<script>
const logged = JSON.parse(localStorage.getItem('loggedIn'));
if(!logged || logged.role!=='admin'){
  alert('Access denied. Please log in as admin.');
  window.location.href='admin_login.html';
}

let deleteEmpId = null;

// Render confirmed employees
function renderEmployees(){
  const container = document.getElementById('tableContainer');
  const users = JSON.parse(localStorage.getItem('users')) || [];
  const employees = users.filter(u => u.role==='employee' && u.status==='confirmed');

  if(employees.length===0){
    container.innerHTML='<div style="text-align:center; padding:30px; background:#f8d7da; color:#721c24; border-radius:10px; margin:30px auto; max-width:500px; font-weight:bold;">No employees added yet.</div>';
    return;
  }

  let table = `<table>
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Email</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>`;
  employees.forEach(u=>{
    table+=`<tr>
      <td>${u.id}</td>
      <td>${u.name}</td>
      <td>${u.email}</td>
      <td>${u.status}</td>
      <td>
        <button class="action-btn info-btn" onclick="showInfo(${u.id})">Info</button>
        <button class="action-btn delete-btn" onclick="showDelete(${u.id})">Delete</button>
      </td>
    </tr>`;
  });
  table+='</tbody></table>';
  container.innerHTML=table;
}

// Show info modal
const modalBg = document.getElementById('modalBg');
function showInfo(id){
  const users = JSON.parse(localStorage.getItem('users')) || [];
  const user = users.find(u=>u.id===id);
  if(!user) return;
  document.getElementById('mName').value = user.profile?.name || user.name;
  document.getElementById('mAddress').value = user.profile?.address || '';
  document.getElementById('mDepartment').value = user.profile?.department || '';
  document.getElementById('mSkills').value = user.profile?.skills || '';
  document.getElementById('mDob').value = user.profile?.dob || '';
  document.getElementById('mStatus').value = user.status || '';
  modalBg.style.display='flex';
}

function closeModal(){
  modalBg.style.display='none';
}

// Delete confirmation
const confirmBox = document.getElementById('confirmBox');
const successMsg = document.getElementById('successMsg');

function showDelete(id){
  deleteEmpId = id;
  confirmBox.style.display = 'block';
}

function cancelDelete(){
  confirmBox.style.display = 'none';
}

function confirmDelete(){
  let users = JSON.parse(localStorage.getItem('users')) || [];
  users = users.filter(u => u.id !== deleteEmpId);
  localStorage.setItem('users', JSON.stringify(users));
  confirmBox.style.display='none';
  successMsg.style.display='block';
  renderEmployees();
  setTimeout(()=>{ successMsg.style.display='none'; }, 2000);
}

renderEmployees();
</script>

</body>
</html>